{% set id = uid() %}
{% set shop = global.common.shopInfo.shop %}

{% set localClass = id %}

<div class="{{ globalClass }}__container {{ localClass }}__container">
  <div class="box">
    <div class="{{ globalClass }}__cart-icon" data-cart-icon="1">
      {% render_snippet 'Icons: Cart' %}
      <span class="{{ globalClass }}__cart-length" data-cart-length="1"></span>
    </div>
  </div>

  <div
    class="sliding-panel sliding-panel--from-right {{ globalClass }}__dropdown {{ localClass }}__dropdown"
    data-cart-dropdown="1"
  >
    <div class="sliding-panel__container {{ globalClass }}__dropdown-container">
      <header class="sliding-panel__header {{ globalClass }}__dropdown-header">
        <div class="{{ globalClass }}__dropdown-header-info">
          <h6 class="{{ globalClass }}__dropdown-header-title {{ localClass }}__dropdown-header-title">
            {{ properties.title | t }}
          </h6>

          {% if properties.description %}
            <p class="{{ globalClass }}__dropdown-header-description {{ localClass }}__dropdown-header-description">
              {{ properties.description | t }}
            </p>
          {% endif %}
        </div>

        <div class="{{ globalClass }}__close-icon" data-close-icon="1">
          {% render_snippet 'Icons: Close' %}
        </div>
      </header>

      <div class="{{ globalClass }}__dropdown-body">
        <div class="{{ globalClass }}__dropdown-products" data-cart-dropdown-body="1">
        </div>
      </div>

      <div class="sliding-panel__footer {{ globalClass }}__dropdown-footer">
        <div class="unselectable {{ globalClass }}__checkout-button" data-cart-checkout-button="1">
          {% render_snippet 'Shared: Link button',
            properties={
            'label': properties.checkout_button_label | t,
            'url': 'javascript:void(0);',
            'icon_snippet': 'Icons: Arrow right 1'
          }
          %}
        </div>
      </div>
    </div>
  </div>
</div>

<script id="cart-item-template-{{id}}" type="text/x-jsrender">
  <div id="{% raw %}cart-product-{{:product.uniqid}}{% endraw %}" class="{{ globalClass }}__dropdown-item">
    <div class="{{ globalClass }}__dropdown-item-image {% raw %}{{if !hasImage }}image-placeholder{{/if}}{% endraw %}">
      {% raw %}
        {{if hasImage }}
          <img src="{{:product.cdn_image_url}}" alt="{{:product.title}}" />
        {{else}}
      {% endraw %}

          {% render_snippet 'Product: Placeholder icon', product={} %}

      {% raw %}
        {{/if}}
      {% endraw %}
    </div>

    <div class="{{ globalClass }}__dropdown-item-info">
      <div class="{{ globalClass }}__dropdown-item-title">
        {% raw %}
          {{:product.title}}
        {% endraw %}
      </div>

      <div class="{{ globalClass }}__dropdown-item-price">
        {% raw %}
          {{if isFree}}
        {% endraw %}
            {% render_snippet 'Tag', tag=('shop.shared.titles.free' | t), is_success=true %}
        {% raw %}
          {{else}}
            {{if isPriceDiscount}}
              {{:product.currency_title}}{{:product.price_with_discount}}
              <span class="price-without-discount">{{:product.currency_title}}{{:product.price}}</span>
            {{else}}
              {{:product.currency_title}}{{:product.price}}
            {{/if}}
          {{/if}}
        {% endraw %}
      </div>

      <div class="{{ globalClass }}__dropdown-item-buttons unselectable">
        <span
          class="{{ globalClass }}__count-picker unselectable"
          data-product-id="{% raw %}{{:product.uniqid}}{% endraw %}"
          data-cart-remove-button="1"
        >
          {% render_snippet 'Icons: Minus' %}
        </span>

        <div class="{{ globalClass }}__product-quantity unselectable" data-cart-product-quantity="1">
          {% raw %}{{:product.quantity}}{% endraw %}
        </div>

        <div
          class="{{ globalClass }}__count-picker unselectable"
          style="visibility: {% raw %}{{if isValidPlus}}initial{{else}}hidden{{/if}}{% endraw %}"
          data-product-id="{% raw %}{{:product.uniqid}}{% endraw %}"
          data-cart-add-button="1"
        >
          {% render_snippet 'Icons: Plus' %}
        </div>
      </div>

      <div
          class="{{ globalClass }}__remove-icon"
          data-product-id="{% raw %}{{:product.uniqid}}{% endraw %}"
          data-cart-remove-product-button="1"
        >
          {% render_snippet 'Icons: Trash' %}
        </div>
    </div>
  </div>
</script>

<script type='application/javascript'>
  $(document).ready(function () {
    const cart = window.SellixCartStoreFactory.getCart('{{shop.name}}');
    const cartComponent = new SellixCartComponent(
      '.{{ localClass }}__container',
      cart,
      '#cart-item-template-{{id}}',
      {{renderOptions | dump | safe}},
    );
    cartComponent.render();
  });
</script>
