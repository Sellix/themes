{% set id = uid() %}
{% set shop = global.common.shopInfo.shop %}
{% set invoice = args.invoice %}
{% set products = args.products %}
{% set properties = args.properties %}
{% set colors = themeProperties.current_colors %}

{% set bgColor = safe_get(properties.container_background_color, 'background_accent_dark') %}
{% set showBorder = safe_get(properties.container_show_border, true) %}
{% set shadow = safe_get(properties.container_shadow, 'none') %}
{% set borderRadius = safe_get(properties.container_border_radius, 8) %}
{% set paddingVert = safe_get(properties.container_padding_vert, 16) %}
{% set paddingHoriz = safe_get(properties.container_padding_horiz, 16) %}

{% set productShowBorder = safe_get(properties.product_container_show_border, true) %}

{% set globalClass = ['snippet-checkout-products'] %}
{% set localClass = id %}

<style>
  .{{ localClass }} {
    background: {{ colors[bgColor] }};
    border: {{ "1px solid var(--borderColor)" if showBorder else "none" }};
    box-shadow: {{ shadow }};
    border-radius: {{ borderRadius }}px;
    padding: {{ paddingVert }}px {{ paddingHoriz }}px;
  }
  {% if showBorder and not productShowBorder %}
    .snippet-checkout-product:not(:last-of-type) {
      border-bottom: 1px solid var(--borderColor);
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }
  {% endif %}
</style>

<div class="{{ globalClass }} {{ localClass }}">
  {% for product in products %}
    {% render_snippet
      'Checkout: Product',
      product=product,
      invoice=invoice,
      quantity=product.quantity,
      properties=properties
    %}
  {% endfor %}
</div>

<script type='application/javascript'>
  $(document).ready(function () {
    const cart = window.SellixCartStoreFactory.getCart('{{shop.name}}');
    new SellixCheckoutProductsComponent(
      '.{{ localClass }}',
      cart,
      {{renderOptions | dump | safe}},
      {{properties | dump | safe}},
    );
  });
</script>
