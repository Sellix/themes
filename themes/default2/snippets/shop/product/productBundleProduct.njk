{% set product = args.product %}
{% set properties = args.properties %}
{% set colors = themeProperties.current_colors %}

{% set rating = (product.average_score if product.average_score else 0) | float %}
{% set productStock = product.stock %}
{% set productStockTitle = ('∞' if product.stock === -1 else get_stock(product.stock)) %}
{% set onHold = product.on_hold | int %}
{% set isRatingGold = rating > 4 %}

{% set isFree = product.price_display | float === 0 %}
{% set isDisabled = product.stock | int === 0 or onHold %}
{% set isPlaceholder = not product.cloudflare_image_id %}
{% set image = cdn_link(product.cloudflare_image_id, 'shopItem') %}

{% set titleFontColor = safe_get(properties.bundle_product_title_font_color, 'dark_font_color') %}
{% set titleFontSize = safe_get(properties.bundle_product_title_font_size, 14) %}
{% set titleFontWeight = safe_get(properties.bundle_product_title_font_weight, 500) %}
{% set titleLineHeight = safe_get(properties.bundle_product_title_line_height, 20) %}

{% set priceFontColor = safe_get(properties.bundle_product_price_font_color, 'dark_font_color') %}
{% set priceFontSize = safe_get(properties.bundle_product_price_font_size, 14) %}
{% set priceFontWeight = safe_get(properties.bundle_product_price_font_weight, 500) %}
{% set priceLineHeight = safe_get(properties.bundle_product_title_price_height, 20) %}

{% set initialPriceFontColor = safe_get(properties.bundle_product_initial_price_font_color, 'dark_font_color') %}
{% set initialPriceFontSize = safe_get(properties.bundle_product_initial_price_font_size, 14) %}
{% set initialPriceFontWeight = safe_get(properties.bundle_product_initial_price_font_weight, 500) %}
{% set initialPriceLineHeight = safe_get(properties.bundle_product_initial_title_price_height, 20) %}

{% set stockColor = '#28a745' if (productStock === -1 or productStock > 1) else '#dc3545' %}

{% set globalClass = ['snippet-product-bundle-product'] %}
{% set localClass = [globalClass, '-', id] | join %}

<style>
  .{{ localClass }}__title {
    color: {{ colors[titleFontColor] }}!important;
    font-size: {{ titleFontSize }}px;
    font-weight: {{ titleFontWeight }};
    line-height: {{ titleLineHeight }}px;
  }

  .{{ localClass }}__price {
    color: {{ colors[priceFontColor] }}!important;
    font-size: {{ priceFontSize }}px;
    font-weight: {{ priceFontWeight }};
    line-height: {{ priceLineHeight }}px;
  }

  .{{ localClass }}__price span {
    color: {{ colors[initialPriceFontColor] }}!important;
    font-size: {{ initialPriceFontSize }}px;
    font-weight: {{ initialPriceFontWeight }};
    line-height: {{ initialPriceLineHeight }}px;
  }

  .{{ localClass }}__info .stock span {
    color: {{ stockColor }};
  }

  {#.{{ localClass }}__cart-button .snippet-cart-button-1__button {#}
  {#  color: {{ colors[priceFontColor] }}!important;#}
  {#  background-color: transparent;#}
  {#}#}
</style>

<div class="{{ globalClass}} {{ localClass}} {{'is-disabled' if isDisabled}} {{'no-cart' if args.cartEnabled}}">
  {{ productStoc }}

  <a class="{{ globalClass }}__description {{ localClass }}__description" href='/product/{{ product.uniqid }}' target="_blank">
    <div class="{{ globalClass }}__image {{ localClass }}__image {{'placeholder' if isPlaceholder}}">
      {% if isPlaceholder %}
        <i class="fa-light fa-layer-group"></i>
      {% else %}
        <img src="{{image}}" alt="{{product.title}}" loading="lazy" />
      {% endif %}
    </div>

    <div class="{{ globalClass }}__content">
      <div class="{{ globalClass }}__title {{ localClass }}__title">
        <span>
          {{product.title}}
        </span>

        {% if rating %}
          <span class="{{ globalClass }}__star {{'text-gold' if isRatingGold else ''}}">
              <span class="mr-1 position-relative {{'text-gold' if isRatingGold else ''}}">
                  <i class="fas fa-star" style="font-size: 11px;"></i>
              </span>
              <span>{{5 if rating === 5 else (rating | float | round(2))}}</span>
          </span>
        {% endif %}
      </div>

      {% if onHold %}
        <span>
          {% render_snippet 'Tag', tag=('shop.shared.titles.onHold' | t) %}
        </span>
      {% else %}
        <div class="{{ globalClass }}__info {{ localClass }}__info">
          {% if product.price_discount and not isFree %}
            <span class="{{ globalClass }}__price {{ localClass }}__price with-discount">
              {% render_snippet
                'Price',
                currency=product.currency,
                price=product.price_display,
                discount=product.price_discount
              %}
              <span>{% render_snippet 'Price', currency=product.currency, price=product.price_display %}</span>
            </span>
          {% else %}
            <span class="{{ globalClass }}__price {{ localClass }}__price">
                {% if isFree%}
                  {{ 'shop.shared.titles.free' | t }}
                {% else %}
                  {% render_snippet 'Price', currency=product.currency, price=product.price_display %}
                {% endif %}
            </span>
          {% endif %}

          <span class="dot">  ●  </span>

          <span class="stock">
              <span>
                  {% if productStock === -1 %}
                    <i class="fa-solid fa-infinity" style="font-size: 10px; color: {{ stockColor }}"></i>
                  {% else %}
                    {{productStockTitle}}
                  {% endif %}
              </span> {{ 'shop.shared.titles.stock' | t | lower }}
          </span>
        </div>
      {% endif %}
    </div>
  </a>

  <div class="{{ globalClass }}__buttons {{ localClass }}__buttons unselectable {{'with-cart' if args.cartEnabled else ''}}">
    {% if not isDisabled and not isFree %}
      <div class="{{ globalClass }}__cart-button {{ localClass }}__cart-button">
        {% render_snippet
          'Cart button 1',
          product=product,
          is_static=true,
          redirect_to_checkout=args.redirectToCheckout,
          properties={
            'background_color': 'transparent',
            'color': priceFontColor
          }
        %}
      </div>
    {% endif %}
    {% if isDisabled and args.cartEnabled %}
      <div></div>
    {% endif %}
    {% if args.skipBuyButton %}
      <div></div>
    {% else %}
      <a href="{{'javascript:void' if isDisabled else ['product/', product.uniqid] | join}}" style="color: white;">
        <div class="{{'disabled' if isDisabled else ''}} buy-button">
          {% if isFree %}
            {{ 'shop.shared.titles.getIt' | t }}
          {% else %}
            {{ 'shop.shared.titles.buy' | t }}
          {% endif %}
        </div>
      </a>
    {% endif %}
  </div>
</div>
