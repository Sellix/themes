{% set hideOutOfStock = args.hideOutOfStock or shop.hide_out_of_stock | int %}
{% set cartEnabled = args.cartEnabled or global.common.cartEnabled %}
{% set products = args.products %}

{% set globalClass =  'snippet-product-list' %}
{% set localClass = id %}

<style>
  .{{ localClass }} {
  }
</style>

<div class="{{ globalClass }} {{ localClass }}">
  {% for product in products %}
    {% set onHold = product.on_hold | int %}
    {% set isDisabled = product.stock === 0 or onHold %}
    {% set isFree = product.price_display | float === 0 %}
    {% set isPlaceholder = not product.cloudflare_image_id %}
    {% set image = cdn_link(product.cloudflare_image_id, 'shopItem') %}
    {% set rating = (product.average_score if product.average_score else 0) | float %}
    {% set isRatingGold = rating | float > 4 %}
    {% set productStock = ('∞' if product.stock === -1 else get_stock(product.stock)) %}

    {% if hideOutOfStock and product.stock == 0 %}
      {# hide Out of stock products #}
    {% else %}
      <div class="{{ globalClass }}__option {{'is-disabled' if isDisabled}} {{'' if cartEnabled}}">
        <a
          href="{{'javascript:void' if isDisabled else ['product/', product.uniqid] | join}}"
          class="{{ globalClass }}__option-description"
        >
          {% if not isFree %}
            {# {% render_snippet 'Discount badge', product=product, isGroup=true %} #}
          {% endif %}

          <div class="{{ globalClass }}__option-image {{'placeholder' if isPlaceholder else ''}}">
            {% if isPlaceholder %}
              <i class="fa-light fa-layer-group"></i>
            {% else %}
              <img src="{{image}}" alt="{{product.title}}" loading="lazy" />
            {% endif %}
          </div>

          <div class="{{ globalClass }}__option-content">
            <div class="{{ globalClass }}__option-title">
              <span>{{product.title}}</span>

              {% if rating %}
                <span class="{{ globalClass }}__option-star {{'text-gold' if isRatingGold else ''}}">
                  <span class="mr-1 position-relative {{'text-gold' if isRatingGold else ''}}">
                    <i class="fas fa-star" style="font-size: 11px;"></i>
                  </span>
                  <span>{{5 if rating === 5 else (rating | float | round(2))}}</span>
                </span>
              {% endif %}
            </div>

            {% if onHold %}
              <span>
                {{ 'shop.main.cards.group.onHold' | t }}
              </span>
            {% else %}
              <div class="{{ globalClass }}__option-info">
                {% if product.price_discount and not isFree %}
                  <span class="{{ globalClass }}__option-info-price with-discount" >
                    <i>{% render_snippet 'Price', currency=product.currency, price=product.price_display %}</i>
                    {%- render_snippet 'Price', currency=product.currency, price=product.price_display, discount=product.price_discount -%}
                  </span>
                {% else %}
                  <span class="{{ globalClass }}__option-info-price" >
                    {% if isFree%}
                      {{ 'shop.shared.titles.free' | t }}
                    {% else %}
                      {% render_snippet 'Price',
                        currency=product.currency,
                        price=product.price_display,
                        priceVariants=product.price_variants
                      %}
                    {% endif %}
                  </span>
                {% endif %}

                <span class="{{ globalClass }}__option-dot">  ●  </span>

                <span class="stock {{ globalClass }}__stock">
                  <span
                    class="{{'text-red' if productStock | int === 0 else 'text-green'}}"
                    style="color: {{'#dc3545' if productStock == 0 else '#28a745'}}; position: {{'relative' if productStock === '∞' else 'static'}}; top: {{'auto' if productStock === '∞' else 'auto'}}"
                  >
                    {% if productStock === '∞' %}
                      <i class="fa-solid fa-infinity" style="font-size: 10px; color: {{'#dc3545' if productStock === 0 else '#28a745'}}"></i>
                    {% else %}
                      {{productStock}}
                    {% endif %}
                  </span> {{ 'shop.main.cards.group.inStock' | t }}
                </span>
              </div>
            {% endif %}
          </div>
        </a>

        <div class="{{ globalClass }}__option-buttons unselectable {{'with-cart' if cartEnabled else ''}}">
          {% if not isDisabled and not isFree and product.type != 'SUBSCRIPTION' %}
            {% render_snippet 'Cart button 1', product=product, is_static=true %}
          {% else %}
            <div></div>
          {% endif %}

          <a href="{{'javascript:void' if isDisabled else ['product/', product.uniqid] | join}}" style="color: white;">
            <div class="buy-button {{ 'disabled' if isDisabled else '' }}">
              {% if isFree %}
                {{ 'shop.shared.titles.getIt' | t }}
              {% else %}
                {{ 'shop.shared.titles.buy' | t }}
              {% endif %}
            </div>
          </a>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>
